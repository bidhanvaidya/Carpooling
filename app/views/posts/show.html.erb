<script type="text/javascript"
	src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDqWLscHGWh6uk6zlpMat3AUb7lCwWnB24&sensor=false">
</script>
<script type="text/javascript">
		//Variable for holding map object
		var map;

		//Variable for direction objects map object
		var directionsDisplay = new google.maps.DirectionsRenderer();
		var directionsService = new google.maps.DirectionsService();

		jQuery(document).ready(function(){
			/*Map initialization*/
			function initialize() {
				//Create a location object with latitude and longitudes
				var startLoc = new google.maps.LatLng(<%=@post.start.latitude%>, <%=@post.start.longitude%>);

				//Create options for the map object
				var myOptions = {
					zoom:10,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					center: startLoc
				}

				//Create our map
				map = new google.maps.Map(document.getElementById("map"), myOptions);
			}

			/*Function for creating the roadmap*/
			function calcRoute(start, end, mode) {
				var request = {
					origin:start,
					destination:end,
					/*Show the waypoints*/
					waypoints:[					
					  <% @post.stops.each do |stop|  %>
							{location: "<%= stop.address %>"},
						<%end%>	
					],
					travelMode: google.maps.TravelMode[mode]
				};
				directionsService.route(request, function(result, status) {
					if (status == google.maps.DirectionsStatus.OK) {
						directionsDisplay.setDirections(result);
					}
				});

				directionsDisplay.setMap(map);
			}

			initialize();
			calcRoute('<%=@post.start.address%>', '<%=@post.finish.address%>', 'DRIVING');
		});
	</script>

<div id="midcontainer">
	<div id="postShowStripe"><%=@post.start.city%> <%= image_tag "arrow_right.png" %> <%=@post.finish.city%></div>


<table>
	<tr height="20px"></tr>
	<tr>
		<td>
			<div id="postMap">
				<div style="height:17px;"> </div>
				<div id="map" style="width:664px; height:316px; margin-left:18px; padding-top:18px;"></div>
			</div>
		</td>
		<td width="17px"></td>
		<td>
			<div style="display:inline;">
				<div class="panelprofile" style="height:392px;">

				<!- profile picture   edit the link with correct facebook user ID ->
				<div class="circle-image-one-fourth" style="margin-left:10px;">
					<img class="aligncenter" src="http://graph.facebook.com/100000091986399/picture&type=large">
				</div>
				
				<%= @post.user.name %>
			</div>
		</td>
	</tr>
</table>


<div class = "controls">
	<h3><%=@post.start.city%>, <%=@post.start.state%>
<%= image_tag "arrow_right.png" %> <%=" " +@post.finish.city%>, <%=@post.finish.state%></h3>

<%result=Geocoder.search(@post.start.address)  %>
<%= result.first.address%>
<p>
  <b>Departs at </b>
  <%= @post.starttime %>
</p>

<p>
 <strong>This ride goes through the following places</strong><br>

  <% @post.stops.each do |stop|  %>
  	<%= stop.city %>, <%= stop.state %> <br>
	<%end%>
</p>



<div class="form-actions">
  <%= link_to 'Back', posts_path, :class => 'btn'  %>
<% if @post.user == current_user %>
  <%= link_to 'Edit', edit_post_path(@post), :class => 'btn' %>
  <%= link_to 'Delete', post_path(@post), :method => 'delete', :confirm => 'Are you sure?', :class => 'btn btn-danger' %>
 <%end%>
</div>
</div>
</div>	
